# 이메일 보안
# 이메일 시스템 구조
<!-- # 인터넷 이메일 시스템 동작방식 이미지 -->
<!-- # 메일 서버 구조 이미지 -->


## 주요 프로토콜
### SMTP(Simple Mail Transfer Protocol): 메일 전송 프로토콜
* 메일 클라이언트(MUA)와 메일서버(MTA) 또는 송수신 서버(MTA) 간에 메일 전송을 위해 사용하는 프로토콜로 `25/tcp` 포트 사용
* __SMPTS__ (SMTP over SSL/TLS): SMTP 통신 구간에 SSL/TLS 보안을 적용한 프로토콜로 `465/tcp` 포트 사용


### POP3(Post Office Protocol version 3): 메일 접근 프로토콜
* 메일 클라이언트(MUA)에서 메일 서버(MTA)로부터 메일을 수신할 수 있도록(읽을 수 있도록) 해주는 프로토콜 `110/tcp` 포트 사용
* 클라이언트가 메일을 서버로부터 가지고 온 후(다운로드한 후) 서버에서 해당 메일을 삭제하기 떄문에 다른 곳에서(다른 클라이언트에서) 메일 확인이 불가능하다. 
* __POP3S__(POP3 over SSL/TLS): POP3 통신 구간에 SSL/TLS 보안을 적용한 프로토콜로 `995/tcp` 포트 사용

### IMAP(Internet Message Access Protocol): 메일 접근 프로토콜
* 메일 클라이언트(MUA)에서 메일 서버(MTA)로부터 메일을 수신할 수 있도록(읽을 수 있도록) 해주는 프로토콜로 `143/tcp` 포트 사용
* POP3 와 다르게 서버로부터 메일을 다운로드하는 것이 아닌 복사해오는 방식이기 때문에 클라이언트가 메일을 서버로부터 가져온 후에도 서버에 해당 메일이 계속 남아 있게 된다. 따라서 다른 곳에서도(다른 클라이언트에서도) 메일 확인이 가능하다. 
* __IMAPS__(IMAP over SSL/TLS): IMAP 통신 구간에 SSL/TLS 보안을 적용한 프로토콜로 `993/tcp` 포트 사용


## 메일 서버 구조

### MUA(Mail User Agent)
* 사용자가 메일을 송수신하기 위해 사용하는 메일 클라이언트 프로그램으로 메일을 작성하거나 메일함에 도착한 메일을 확인하는 기능을 수행한다. 
* 대표적인 MUA에는 아웃룩(Outlook), 썬더버드(Thunderbird) 등이 있다. 

### MTA(Mail Transfer Agent)
* 메일 서버 프로그램으로 수신한 메일을 분석하여 수신자가 자신이 아닌 메이주소라면 해당 주소의 메일 서버로 전송하고(메일 릴레이 기능) 수신자가 자신의 메일 주소라면 MDA를 통해 각 사용자 메일함에 저장하도록 한다. 
* 대표적인 MTA에는 Sendmail, Qmail 등이 있다. 

### MDA(Mail Delivery Agent)
* 사용자 메일함에 메일을 저장해주는 프로그램으로 메일이 최종 수신 메일 서버(MTA)에 도착했을 때 메일 서버는 MDA에 메일을 전달하고 MDA는 해당 사용자 메일함에 메일을 저장한다. 
* 대표적인 MDA에는 프록메일(Procmail)등이 있다. 

### MRA(Mail Retrieval Agent)
* 메일 클라이언트(MUA)가 확인을 요청하는 메일을 사용자 메일함에서 사용자로 전달해주는 프로그램으로 MUA와 MRA간 통신은 POP3 또는 IMAP 프로토콜을 기반으로 한다. 


## 이메일시스템 동작방식
1. 사용자는 메일 클라이언트(MUA)를 이용하여 메일을 작성한 후 SMTP 프로토콜을 통해 클라이언트가 설정한 메일서버(MTA)로 전송한다. 
2. 메일 서버(MTA)는 메일 큐에 수신한 메일을 임시 저장한 후, 수신한 메일을 분석하여 수신자가 자신이 아닌 메일주소라면 해당 주소의 메일 서버로 SMTP 프로토콜을 통해 전송하고 수신자가 자신의 메일 주소라면 MDA를 통해 각 사용자 메일함에 파일 형태로 저장한다. 
	* Sendmail 서버의 경우 메일 큐로 `/var/spool/mqueue` 디렉터리를 사용하고 각 사용자 메일함은 `/var/spool/mail` 디렉터리에 위치한다. 
	* 수신자 메일주소의 메일 서버 확인 방법: 메일 주소에 있는 도메인을 이용하여 MX(Mail Exchanger)레코드에 대한 DNS 질의를 수행한다. 
3. 사용자 메일 클라이언트(MUA)를 통해 자신의 메일 확인을 요청하면 MRA는 해당 사용자의 메일함에 있는 메일을 POP3 또는 IMAP 프로토콜을 이용하여 클라이언트에게 전달한다. 





