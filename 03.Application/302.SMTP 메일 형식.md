# 이메일 보안
# SMTP 메일 형식
<!-- # SMTP 메일 형식 이미지 -->
* SMTP는 텍스트 기반의 프로토콜로 봉투(Envelope)와 메시지(Message) 정보를 주고 받는다. 
* 봉투는 메일 서버 간에 메일을 주고받기 위한 메일주소 정보를 담고 있는 부분으로 메일 수신자에게 전달되는 정보가 아니다. 
  * MAIL FROM: 발신자 메일주소로 수신 메일 서버가 신뢰할 수 있도록 공격자에 의해 악의적으로 조작되는 경우가 있으므로 신뢰성이 낮다. 
  * RCPT TO: 수신자 메일 주소
* 메시지는 메일 수신자에게 보이는 메일 내용으로 다양한 메시지 헤더와 메시지 바디로 구성되어 있다. 주요 헤더 정보를 살펴보면 다음과 같다. 
  * __From__: 보낸 사람, 발신자의 메일 주소로 수신자가 신뢰할 수 있도록 공격자에 의해 악의적으로 조작되는 경우가 있으므로 신뢰성이 낮다. 
  * __To__:  받는 사람, 수신자의 메일 주소
  * __Subject__: 메일 제목


## SMTP 프로토콜 취약점 및 대응기술
### 발신 메일 서버 조작(스푸핑)
* 메일 봉투의 MAIL FROM 정보는 조작할 수 있으므로 공격자는 실제와 다른 신뢰할만한 발신자 메일주소로 조작하여 수신 메일 서버를 속일 수 있다. 
* 수신한 메일이 MAIL FROM에 명시한 발신자 메일 주소의 정당한(인증된) 메일서버로부터 온 메일인지 검사할 수 있는 __SPF(Sender Policy Framwork)__ 메일 인증 기술을 적용한다. 


### 메일 메시지 훔쳐보기(스니핑) 및 조작(스푸핑)
* 기본적으로 평문 텍스트로 메일을 전송하기 때문에 전송구간에서 공격자가 부정한 방법으로 메일을 가로채 메시지(헤더 및 바디)를 훔쳐보거나 조작하는(위변조하는) 중간자공격이 발생할 수 있다. 
* 발신자 측에서 메일의 메시지에 대한 디지털서명을 추가하여 메일의 위변조 여부를 검사할 수 있는 __DKIM(DomainKeys Identified Mail)__ 메일 인증 기술을 적용한다. 
* 메일 서버와 클라이언트 통신 구간 보안(암호화) 적용이 가능한 SMTPS, POP3S, IMAPS 등의 프로토콜을 설정하여 메일 스니핑 공격을 방지한다. 

### DMARC(Domain-based Message Authentication, Reporting and Conformancd) 메일 인증 기술의 적용
* DMARC 메일 인증 기술은 인증 정책을 통해 SPF와 DKIM 인증 기술을 모두 적용할 수 있고 인증 결과에 대한 모니터링이 가능한 기술로 메인 보안을 한층 더 강화할 수 있다. 







