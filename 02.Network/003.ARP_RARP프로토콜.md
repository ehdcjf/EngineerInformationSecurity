# ARP 및 RARP 프로토콜 특징
* 논리적인 주소와 물리적인 주소 사이의 변환을 담당하는 프로토콜
* ARP(Address Resolution Protocol): 논리적인 IP 주소를 물리적인 MAC 주소로 변환해주는 역할을 하는 프로토콜
* RARP(Reverse ARP)
  * 물리적인 MAC 주소를 논리적인 IP 주소로 변환해주는 역할을 하는 프로토콜
  * 일반적으로 IP 주소는 시스템의 하드디스크 내 설정 파일에 저장되어 있지만 하드디스크가 없는 터미널의 경우에 초기 가동될 때 자신의 MAC 주소를 담아 RARP 요청을 만들어 자신의 IP 주소 정보를 받아오게 된다. MAC에 해당하는 IP 주소 정보를 관리하는 RARP 서버가 구성되어 있어야 한다. 

# ARP 동작방식
* 최초 상대방의 물리적인 주소를 알지 못하기 때문에(논리적인 IP 주소만 알고 있는 상태) ARP 요청(Request) 메시지를 만들어 브로드캐스트한다. 
* ARP 요청 메시지를 캡슐화한 이더넷 프레임의 목적지 MAC 주소를 살펴보면 브로드캐스트 주소인 "FF:FF:FF:FF:FF:FF"로 설정된 것을 확인할 수 있다. 
* Target 호스트에서는 ARP 응답(Reply)메시지를 만들어서 응답한다. 응답메시지에는 Target호스트의 MAC 주소 정보가 담겨 있으며 응답자는 요청자의 MAC 주소를 알고 있으므로 유니캐스트 방식으로 응답한다. Target이 아닌 호스트들은 수신한 브로드캐스트 요청 메시지를 폐기한다. 
* ARP 응답메시지를 캡슐화한 이더넷 프레임의 목적지 MAC 주소를 살펴보면 요청 메시지를 보낸 호스트의 MAC 주소로 설정된 것을 확인할 수 있다. 
* 각 시스템은 ARP Cache가 있고 Cache에 이 정보를 보관해 둔다. 물론 일정 시간 경과 후에는 삭제된다. 


# RARP 동작방식
* 최초 자신의 논리적인 IP 주소를 알지 못하기 때문에(물리적인 MAC 주소만 알고 있는 상태) 자신의 MAC 정보를 담고 있는 RARP 요청(Request) 메시지를 만들어서 브로드캐스트 한다.
* RARP Server는 요청자의 IP 주소 정보를 담은 RARP 응답(Reply) 메시지를 만들어 요청자의 MAC 주소로 유니캐스트 방식으로 응답을 준다. 

# ARP cache table
* ARP 요청을 통해 알아낸 MAC 정보는 OS에 따라 다르지만 통상 1~2분 정도 메모리에 저장한다. 
* `arp -a` 명령을 통해 ARP cache table을 살펴보면 타입이 dynamic 또는 static으로 지정되어 있다. dynamic으로 된 것은 arp에 의해 동적으로 설정된 것으로 일정 시간 동안 유지된다. static으로 된 것은 관리자에 의해 정적으로 설정된 것으로 관리자가 삭제하거나 시스템이 종료하기 전까지 지속적으로 유지된다.

|명령어|설명|
|--|--|
|`arp -a`|캐시 내용 보기|
|`arp -d`|캐시 내용 삭제|
|`arp -s`|캐시 정적 설정|


# ARP Spoofing(ARP Cache Poisoning)
1. 공격자(M)가 희생자의(A,B) MAC 주소를 자신의 MAC 주소로 위조한 ARP Reply를 만들어 희생자에 지속적으로 전송하면 희생자 ARP Cache Table 의 MAC 정보가 공격자의 MAC 정보로 지속적으로 변경된다. 이를 통해서 희생자 간의 송수신 패킷을 공격자가 스니핑하는 기법이다. 
   * ARP Cache에 동적으로 저장되는 정보는 일정시간 동안만 유지되기 때문에 지속적으로 Cache에 조작된 정보를 저장하기 위해서는 지속적인 전송이 필요하다. 
2. 공격자(M)은 희생자 간에 정상적인 통신이 이루어질 수 있도록(스니핑을 눈치채지 못하도록) IP Forward기능을 활성화한다. 
3. 일반적으로 희생자 ARP Cache의 Gateway(Router) 주소를 공격자 MAC 주소로 변조시켜서 외부로 나가는 데이터를 스니핑하는데 이를 특별히 ARP Redirect 공격이라 한다. 
4. ARP Spoofing은 2계층 주소인 MAC 주소를 속여서 트래픽을 스니핑하는 것이므로 2계층에서 동작하게 된다. 2계층 주소는 서로 다른 네트워크로 라우팅 되지 않기 때문에 공격 대상도 동일한 네트워크 대역이 있어야 한다. 

# ARP Spoofing(ARP Cache Poisoning) 대응방법
1. ARP 요청 및 응답 과정에서 별도의 인증과정이 없는 ARP 프로토콜 자체의 취약점을 이용한 공격이기 때문에 완벽한 방어는 없다. 일반적인 대응 방법은 ARP 캐시를 정적으로 설정하여 ARP 응답(reply)을 수신해도 캐시 정보를 갱신하지 않는 것이다. 
2. 캐시 정보는 시스템 종료 시 삭제되므로 시스템 기동 시마다 ARP 캐시를 정적으로 구성해 주어야 한다. 
3. 네트워크 상의 ARP 트래픽을 실시간으로 모니터링하는 프로그램(ARPWatch 등)을 이용하여 IP와 MAC 주소의 매핑을 감시, 변경 발생 시 즉각 확인하도록 한다. 


# GARP(Gratuitous ARP)
* Gratuitous란 불필요한이란 의미이다. GARP는 별도의 프로토콜이 아니고 Sender IP와 Target IP가 동일한 ARP 요청을 GARP라고 한다. 
* 장비가 ARP 요청 브로드캐스트를 통해 다른 장비에게 네트워크에 있는 자신의 존재를 알리느 목적으로 사용되는 패킷이다. 이 패킷을 수신한 장비는 자신의 ARP Cache에 해당하는 정보가 있다면 이를 갱신한다. 
* 자신의 MAC 정보를 동일한 네트워크 상의 다른 장비들에 알려 ARP Cache를 갱신하도록 하는 목적이다. 

###  GARP 목적
1. 충돌 감지
  * IP 충돌 여부를 GARP를 통해 검색한다. 즉 자신과 동일한 IP가 설정된 호스트가 있다면 해당 호스트로부터 ARP응답(Reply)이 오기 때문에 충돌 여부를 확인할 수 있다. 
  * 일반적으로 호스트 IP를 변경하거나 재부팅 시에 GARP 패킷이 생성된다. 
2. 상대방의 ARP Cache 정보 갱신
  * GARP 메시지를 수신한 쪽에서는 자신의 ARP Cache에 Sender IP 정보를 갱신한다. 
  * 이 부분이 취약점이 될 수 있다. 즉 상태방을 인증하지 않고 Cache 정보를 갱신하게 되므로 악의적인 목적의 공격자에 의해 MAC 정보가 위.변조 될 수 있다. 




