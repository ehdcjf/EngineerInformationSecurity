# DRDoS (Distributed Reflection DoS)
<!-- * DRDoS 이미지 -->
* 공격자는 출발지 IP를 공격대상 IP로 위조(IP Spoofing) 하여 다수의 반사서버(Reflector)로 요청정보를 전송, 공격대상은 반사서버로부터 다수의 응답을 받아 서비스 거부 상태가 되는 공격 유형을 말한다. 
* DRDoS 공격은 다양한 형태로 나타날 수 있다. 몇 가지 유형을 살펴보면 다음과 같다. 
  * TCP의 연결과정(3-Way Handshake)의 취약점을 이용, 위조된 출발지 주소의 SYN 패킷을 반사서버(TCP 서버)로 전달하여 SYN+ACK 응답 패킷이 공격 대상으로 향하도록 하는 방법
  * ICMP 프로토콜의 Echo Request 와 Echo Reply를 이용, 위조된 주소의 Echo Request를 반사서버로 전달하여 Echo Reply가 공격대상으로 향하도록 하는 방법
  * UDP 프로토콜 서비스를 제공하는 서버를 반사서버로 이용하여 그 응답이 공격 대상으로 향하도록 하는 방법
* UDP 프로토콜을 사용하는 DNS, NTP, SNMP, CHARGEN 등의 서비스를 이용한 DRDoS 공격은 크게 반사와 증폭 공격 형태로 나타난다. 공격자는 출발지 IP를 공격대상 IP로 위조하여 취약한 서비스를 사용하는 서버에 대규모의 메시지를 보내고, 서버는 요청에 대한 응답 메시지를 공격 대상 IP에 반사 시도를 한다. 이때 반사된 응답메시지는 대량의 트래픽으로 증폭되어 공격대상에게 전달된다. 

# UDP 기반의 DRDoS 공격
1. DNS 증폭 DRDoS 공격
    * DNS 서버(반사서버 역할)에 많은 양의 레코드 정보를 요구하는 DNS 질의타입(ANY, TXT등)으로 요청하여 공격대상에게 대량의 증폭된 응답 트래픽을 유발시킨다. 
2. NTP 증폭 DRDoS 공격
    * NTP 서버(반사서버 역할)에 최근 접속한 클라이언트 목록(monlist 명령)을 요청하여 공격 대상에게 대량의 응답 트래픽을 유발시킨다. 
3. SNMP 증폭 DRDoS 공격
    * SNMP Agent(반사서버 역할)에 MIB와 같은 정보를 대량 요청하여 공격 대상에게 대량의 증폭된 응답 트래픽을 유발시킨다. 
4. CHARGEN 증폭 DRDoS 공격
    *  CHARGEN 서버(반사서버 역할)에 접속하여 공격대상에게 대량의 증폭된 문자열 응답 트래픽을 유발시킨다. 

# TCP 기반 DRDoS 공격
<!-- # TCP 기반 DRDoS 공격 이미지 -->
* TCP 연결 과정의 취약점을 이용한 디도스 공격
* TCP 서버(e.g. 인터넷에 공개된 웹서버(HTTP/HTTPS), 메일서버(SMTP) 등)를 반사서버로 이용하는 공격으로 출발지 주소를 희생자(공격대상)의 IP 주소로 위조한 후(IP Spoofing) 다수의 연결 요청 패킷(SYN 패킷)을 전송, 증폭된 대량의 SYN+ACK 응답 패킷이 희생자에 전달되어 서비스 거부 상태를 유발시킨다. 
  * 증폭되는 이유: SYN+ACK 패킷에 대한 응답이 없을 경우 TCP 동작 구조상 재전송을 다수 수행하기 때문에 응답이 증폭된다. 

* 공격절차
1. 공격자는 출발지 IP를 희생자 IP로 위조한 후 대량의 SYN 패킷을 반사서버(TCP 서버)로 전송한다. 
2. SYN 패킷을 받은 반사서버는 위조된 출발지 IP로 정상적인 SYN+ACK 응답 패킷을 다수 전송한다. 
3. 희생자는 요청하지 않은 대량의 SYN+ACK 응답 패킷을 반사서버로부터 받아 서비스 거부 상태가 된다. 

# DNS 증폭 DRDoS 공격
<!-- # DNS 증폭 DRDoS 공격 이미지 -->
* DNS 서버(일반적으로 공개된 Recursive/Cache DNS 서버)를 반사서버로 이용하는 디도스 공격
* 출발지 주소를 희생자의 IP 주소로 위조한 후 (IP Spoofing) 요청 대비 응답이 큰 DNS 질의 타입(ANY 타입, TXT 타입)을 다수 요청하여 희생자에 대량의 트래픽을 유발시킨다. 
* 공격절차
1. 공격자는 증폭된 DNS 응답이 희생자 서버(DNS 서버)로 전달될 수 있도록 출발지 IP를 희생자 IP로 위조한 (IP Spoofing) ANY 타입 또는 TXT 타입 질의를 DNS 서버에 다수 요청한다. 
    * IP 스푸핑 공격으로 요청에 대한 응답이 희생자 쪽으로 향하도록 하고, ANY타입 혹은 TXT 타입 질의(요청 질의 대비 응답이 매우 큰)를 사용하여 증폭효과를 효과적으로 한다. 
2. DNS 서버는 다수의 DNS 질의에 대한 응답을 위조된 출발지 IP인 희생자에 응답한다. 
3. 희생자는 요청하지 않은 대량의 DNS 응답을 받아 서비스 거부 상태가 된다. 

* ANY 타입 or TXT 타입 + DNS + 같은 출발지 IP → DNS 증폭 DRDoS 공격

# DRDoS 공격과 일반적인 DoS(DDoS) 공격의 차이점
* DRDoS 공격은 일반적인 DoS(DDoS) 공격에서 더 발전된 공격 형태로 봇넷 기기들이 직접 공격을 수행하는 것이 아니라 증폭 및 반사공격에 활용되는 서비스를 제공하는 서버를 공격 기기로 이용한다. 
* DRDoS 공격은 출발지 IP 주소를 희생자 주소로 위조하고 다수의 반사 서버를 경유하기 때문에 공격 근원지를 파악하는 것이 어렵다. 
* DRDoS 공격은 요청 대비 응답이 크기 때문에 공격 트래픽 효율이 크다. 
* 따라서 공격자 입장에서 일반적인 DDoS 공격보다 DRDoS 공격을 선호하는 이유를 정리해보면 다음과 같다. 
  * 공격의 근원지 파악이 어렵기 때문에 공격 기기(봇넷 기기)들이 노출될 가능성이 적다. 
  * 공격자의 요청 대비 응답이 크기 때문에 공격 트래픽 효율이 좋다. 


# 대응방법
* DRDoS 공격은 출발지 IP를 위조하는 공격이므로 IP 주소가 위조된 패킷이 인터넷 망에 인입되지 않도록 인터넷 서비스 제공자(ISP)가 직접 차단한다. IP 스푸핑에 대응할 수 있는 라우터 (패킷 필터링 장비)의 주요 기법을 정리하면 다음과 같다. 
  * Ingress 패킷 필터링 기법: 라우터를 이용하여 외부에서 내부 네트워크로 들어오는 패킷에 대해 출발지 IP를 체크하여 외부에 존재할 수 없는 IP(사설 IP, 루프백 IP 등 인터넷 상에서 사용되지 않는 IP 대역이 대표적)를 필터링한다. ISP의 경우 연결된 사용자(기관/회사)에 할당한 IP 대역 이외의 출발지 IP로 들어오는 IP를 확인하여 위조여부를 판단할 수 있다. 
  * Egress 패킷 필터링 기법: 라우터를 이용하여 내부에서 외부 네트워크로 나가는 패킷에 대해 출발지 IP를 체크하여 내부에서 관리하고 있는 IP 주소가 아니라면 위조된 주소로 판단하여 필터링한다. 
  * Unicast RPF(Reverse Path Forwording)기법 : 라우터로 유입된 패킷의 출발지 IP에 대해 라우팅 테이블을 이용하여 유입된 인터페이스로 다시 전송되는지 여부를 체크(역경로가 존재하는지)하여 유입된 인터페이스로 다시 전송되지 않는다면 위조된 주소로 판단하여 필터링 한다. 
* ICMP 프로토콜을 이용하는 DRDoS 공격에 (e.g. 스머프 공격) 반사서버로 악욕되지 않도록 다음과 같이 대응한다. 
  * ICMP 프로토콜을 사용할 필요가 없는 시스템의 경우 시스템 설정을 통해 해당 프로토콜을 차단한다. 
  * 네트워크 보안장비를 이용하여 사용할 필요가 없는 ICMP 패킷(트래픽)을 차단한다. 
* DNS 증폭 DRDoS 공격의 반사서버로 DNS 서버가 악용되지 않도록 다음과 같이 대응한다. 
  * 공개용이 아닌 내부 사용자용 DNS 서버라면 서버 설정을 통해 내부 사용자만 DNS 질의가 가능하도록 제한한다. 
  * DNS 서버의 서버 방화벽(e.g. iptables) 또는 네트워크 보안 장비 등을 이용하여 동일한 출발지 IP에 대해 단위 시간(초)당 요청 개수 제한을 설정(임계치 설정)하거나 특정 바이트 이상의 DNS 응답을 차단하도록 설정한다. 
