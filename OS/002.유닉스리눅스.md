# UNIX/Linux 서버 보안











# UNIX/Linux 서버 취약점

### UNIX/Linux 서버 계정 관리
1. root 이외의 UID가 0 금지
   *  root(UID=0)와 동일한 UID를 가진 계정 존재 시 root 권한으로 시스템 접근이 가능하므로 root의 UID를 가진 계정이 존재하지 않도록 확인
   *  root 이외의 계정이 UID=0 인 경우 0이 아닌 적절한 UID를 부여하거나 불필요한 계정일 경우 삭제
  
    |OS|명령어|
    |---|---|
    |SOLARIS,<br>LINUX,<br>HP-UX|usermod -u 2023 ehdcjf|
    |AIX|chuser id=2023 ehdcjf|

<br>

2. 패스워드 복잡성 설정
    * 사용자 계정 암호를 유추하기 쉽게 설정하면 비인가자의 시스템 접근을 허용하게 하는 위험이 존재한다. 
    * 패스워드 관리 방법
        1. 영문, 숫자, 특수문자를 조합하여 계정명과 상이한 8자 이상의 패스워드를 설정한다. 
        2. 영문 대문자, 영문 소문자, 숫자, 특수문자 중 2종류 이상을 조합하여 최소 10자리 이상 또는 3종류 이상을 조합하여 최소 8자리 이상의 길이로 구성한다. 
        3. 시스템마다 상이한 패스워드를 사용하고 패스워드를 기록할 경우에는 변형하여 기록한다. 
        4. 가급적이면 자주 패스워드를 변경한다. 
<br>

3. 패스워드 최소 길이 설정
    * 패스워드 무차별 공격이나 패스워드 추측 공격에 대응하기 위해 패스워드 최소 길이 설정이 필요하다. 최소 8자 이상. 

<br>

4. 패스워드 최대 사용기간 설정
    * 패스워드 최대 사용기간을 설정하지 않으면 일정 기간 경과 후에도 유출된 패스워드로 접속할 수 있다. 
    * 악의적인 사용자의 계속된 접속을 차단하기 위해 패스워드 최대 사용기간을 설정하여 주기적으로 변경할 수 있도록 한다. 
    * 최대 사용 기간을 90일(12주)로 설정한다. 

<br>

5. 패스워드 최소 사용기간 설정
    * 패스워드 최소 사용기간을 설정하지 않으면 사용자에게 익숙한 패스워드로 쉽게 변경할 수 있으며 이를 재사용함으로써 패스워드의 정기적 변경은 무의미해질 수 있다. 
    * 패스워드 최소 사용기간을 1일(1주)로 설정한다. 
  
<br>

6. 패스워드 파일 보호
    * 패스워드 정보를 평문으로 저장하는 경우 정보 유출 피해가 발생할 수 있으므로 패스워드를 암호화하여 보호해야한다. 
    * shadow 패스워드를 사용하여 "/etc/shadow" 파일에 암호화된 패스워드가 저장되도록 하고 권한이 있는 사용자들만 읽을 수 있도록 제한한다. 

<br>

7. Session Timeout 설정
    * 계정이 접속된 상태로 방치되면 권한이 없는 사용자에게 중요한 시스템이 노출되어 악의적인 목적으로 사용될 수 있으므로 일정 시간 이후 어떠한 이벤트가 발생하지 않으면 연결을 종료하는 Session Timeout 설정이 필요하다. 
<br>


### 파일 및 디렉터리 관리
1. root HOME, PATH 디렉터리 권한 및 PATH 설정
    * root 계정의 PATH 환경변수에 "."이 포함되어 있으면 root 계정으로 접속한 관리자가 의도하지 않은 현재 디렉터리에 위치하고 있는 명령어가 실행될 수 있다. 즉 "."이 /usr/bin, /sbin 등의 명령어들이 위치하고 있는 디렉터리보다 우선하여 위치하고 있을 경우, root 계정으로 접속한 관리자가 특정 명령을 실행하면 불법적으로 현재 디렉터리에 위치시킨 파일을 실행하여 예기치 않은 결과를 가져올 수 있다. 
    * PATH 환경 변수에 "."이 맨 앞 또는 중간에 위치하고 있으면 root 가 의도하지 않은 명령이 실행될 수 있으므로 PATH 환경변수의 마지막으로 이동시키거나 불필요한 경우 삭제한다. 
<br>

2. 파일 및 디렉터리 소유자/소유그룹 설정
   * 소유자/소유그룹이 존재하지 않는 파일 및 디렉터리는 현재 없는 소유자/소유그룹의 소유였거나, 관리 소홀로 인해 생긴 파일일 가능성이 있다. 
   * 사용하지 않는 디렉터리나 파일일 경우 시스템 자원 낭비가 될 수 있고 중요한 파일 및 디렉터리일 경우 관리가 되지 않는 문제가 있다. 
    * find 명령의 -nouser -nogroup 옵션을 통해 소유자/소유자그룹이 존재하지 않는 파일/디렉터리를 검색
    ```sh
        $ find .\( -nouser -o -nogroup \) -exec ls -al {} \;
    ```

    * 파일 소유자/소유그룹 변경 또는 불필요 시 삭제
        chown 또는 chgrp 명령을 통해 소유자/소유그룹을 변경한다. 

3. world writable 파일 점검
    * "world writable" 파일이란 모든 사용자(others)에게 쓰기 권한이 부여된 파일을 말한다. 
    * 모든 사용자가 접근 및 수정할 수 있는 권한으로 설정된 파일이 존재하면 일반 사용자의 실수 또는 악의적으로 주요 파일 정보를 변경할 수 있으므로 시스템 장애나 추가적인 공격에 활용될 수 있는 문제가 있다. 
    * find 명령의 "-perm -2" 옵션을 통해 others에 쓰기(w) 권한이 부여된 파일/디렉터리를 검색, others에 대한 쓰기 권한을 제거하거나 불필요한 파일/디렉터리인 경우 삭제
    ```sh
        # 검색
        $ find /home/ehdcjf -perm -2 -exec ls -al {} \;

        $ find /home/ehdcjf -perm -0002 -exec ls -al {} \;

        # 권한 제거
        $ chmod o-w /home/ehdcjf/sample.config

        # 파일 삭제
        $ rm -rf /home/ehdcjf/sample.config

    ```
<br>

4. 주요 파일 소유자 및 권한 설정
    * /etc/passwd : 사용자 정보를 담고 있는 파일로 root 소유의 644 이하의 권한 설정
    * /etc/shadow : 사용자의 암호화된 패스워드 정보를 담고 있는 파일로 root 이외에는 접근 못하도록 root 소유의 400 이하의 권한을 설정
    * /etc/host : IP와 호스트 이름을 매핑하는데 사요되는 파일로 외부의 불법적인 접근에 의한 조작 시 악의적인 시스템에 접근할 가능성이 있으므로 root 소유의 600 이하의 권한을 설정한다. 
    * /etc/(x)inetd.conf : inetd 데몬에 대한 설정파일로 외부의 불법적인 접근에 의해 악의적인 프로그램을 등록하고 root 권한으로 실행할 가능성이 있으므로 root 소유의 600 이하의 권한을 설정한다. 
    * /etc/syslog.conf : syslogd 데몬에 대한 설정파일로 주요 로그파일에 대한 설정 정보를 가지고 있다. 해당 파일의 접근권한이 적절하지 않아 외부의 불법적인 접근에 의하여 변경되는 경우 시스템 로그가 정상적으로 기록되지 않아 외부의 불법적인 접근에 의해 변경되는 경우 시스템 로그가 정상적으로 기록되지 않아 침입자의 흔적 또는 시스템 오류 사항을 정확히 분석할 수 없으므로 root 이외의 사용자는 해당 파일을 변경할 수 없도록 root 소유의 644 이하의 권한을 설정한다. 
    * /etc/services : 서비스 관리(서비스별 포트/프로토콜 정보)정보를 담고 있는 파일로 접근 권한이 적절하지 않아 외부의 불법적인 접근에 의해 변경되는 경우 정상적인 서비스를 제한하거나 허용되지 않는 서비스를 등록하는 등의 위험이 있으므로 root 소유의 644 이하의 권한을 설정한다. 


