# SSL/TLS 관련 취약점

# HeartBleed(하트블리드) 취약점(2014.04)
* 하트블리드 취약점은 통신 구간 암호화를 위해 많이 사용하는 OpenSSL 라이브러리의 하트비트 확장 모듈의 버그로 인해 발생한 취약점으로 서버에 저장된 중요 메모리 데이터가 노출되는 취약점이 발견되었다. 
* CVE-2014-0160: 시스템 메모리 정보 노출 취약점

#### 공격방법
1. 전송: 공격자는 하트비트 패킷 헤더에서 페이로드 길이 필드를 조작하여 서버에 전송
2. 응답: 서버는 공격자가 요청한 길이(최대 64KB)만큼 메모리에서 데이터를 추출하여 공격자에게 응답

#### 주요내용
* 하트비트 확장 모듈은 OpenSSL 1.0.1에 추가된 기능으로 SSL/TLS 프로토콜에서 매번 연결을 재협상하지 않아도 상호 간에 연결 지속 신호를 주고받으면서 통신 연결을 유지하게 해주는 기능이다. 클라이언트가 하트비트를 요청하면서 Payload와 Payload의 길이를 보내면 서버 측에서 하트비트 응답에 그 내용을 길이만큼 복사하여 되돌려주며 연결을 확인한다. 
* 문제는 하트비트 확장모듈에서 클라이언트 하트비트 요청 메시지를 처리할 때 데이터 길이 검증을 수행하지 않아서 시스템 메모리에 저장된 64KB 크기의 데이터를 외부에서 아무런 제한 없이 탈취할 수 있다는 점이다. 
* 노출되는 정보는 서비스 환경에 따라 다르지만, 노출가능한 정보로는 SSL/TLS 서버 개인키, 세션키, 쿠키 및 개인정보(ID/PW, 이메일 주소)가 있다. 

#### 대응방안
* 취약점이 존재하지 않는 OpenSSL로 업데이트
* 네트워크 보안장비 측면 대응 방안
  * HeartBeat 관련 SSL/TLS Record 프로토콜 구조와 비교하여 snort 탐지룰을 분석해보면 다음과 같다. 
    * 룰 헤더의 포트를 보면 SSL/TLS 통신에서 사용하는 기본 포트 443/tcp를 포함하여 자주 사용되는 포트 명시
    * 첫번째 content 옵션은 하트비트 메시지를 의미하는 0x18과 SSL/TLS버전을 의미하는 0x0300(SSLv3.0), 0x0301(TLSv1.0),0x0302(TLSv1.1) 탐지
    * 두번째 content 옵션은 첫번째 content가 매칭된 이후 2바이트 떨어진 위치에 하트비트 요청을 의미하는 0x01 탐지
    * 세번째 content 옵션은 두번째 content가 매칭된 이후 바이트에서 하트비트 Payload Length를 의미하는 2바이트 중 첫번째 바이트가 0x00이 아닌 경우를 탐지, 첫 번째 바이트가 0x00가 아니라는 것은 최소 256바이트에서 최대 65635바이트 크기의 Payload를 요청한다는 의미이다. 
  * 취약점 공격 탐지 및 차단 룰/패턴을 적용한다. 
* 서비스 관리 측면 대응 방안
  * 서버측 SSL/TLS 개인키가 유출되었을 가능성이 있으므로 인증서를 재발급받는 것을 검토
  * 취약점에 대한 조치가 완료된 후 사용자들의 비밀번호 재설정을 유도하여 탈취된 계정을 악용한 추가 피해를 방지하는 방안을 고려


